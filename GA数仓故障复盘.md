# GA数仓故障复盘

| 时间/地点                                   | 现象                                              | 原因                                                         | 解决方案                                                     | 记录                                         |
| ------------------------------------------- | ------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | -------------------------------------------- |
| 2020-01-10                           正式服 | 集群新添加服务器后数据无法入库                    | zookeeper分布式锁卡死，可能和重启zookeeper有关               | 1，增加任务运行状态报警    2，添加机器注意                   | 1.重启后恢复  2.2020-02-05集群添加机器无异常 |
| 2020-01-13  正式服                          | 进程意外退出，自动重启后还是退出                  | 线程安全问题，使用了不安全的集合类                           | 该用线程安全的集合类                                         | 代码已更新                                   |
| 2020-01-20 正式服                           | 数据写入延迟                                      | timeCount没有重置，导致频繁sink数据                          | 刷出数据后重置time Count                                     | 代码已更新                                   |
| 2020-02-02 测试服                           | 测试服导数据进程挂掉，日志缺失                    | 导数据进程意外退出                                           | 用supervisitor执行                                           | 数据重跑后已恢复                             |
| 2020-02-10 正式服                           | 删除已有表，重新导数据异常卡死                    | 1. 表被删除，内存中信息与实际后信息不一致  2. impala连接获取不到 | 1.避免删除已有表重建，可以在暂时中断实时入库进程  2.  连接池设置timeout -1， 增加连接池重试  3 其他地方维护的数据表亦需要重置 | 重启后恢复                                   |
| 2020-03-23                                  | kudu导hive异常                                    | ga_hive.event 开头临时表不在kudu中                           | 1，增加双重判断，保证任务不会断  2.任务重启导致的数据重复问题， 重新维护从ga_tmp导入   3.维护完底层后，查看上层dwm event  LTV 是否需要重新计算 | 修复完毕   环环相扣                          |
| 2020-03-06                                  | python send kafka 没有flush                       | 数据少收录到kafka中，                                        | ！！导数据要加上双方数据验证报警！！   完成任务后更更重要的是 数据的完整性， 准确性，正确性。 | 修复完毕                                     |
| 2020-04-16                                  | TM不断GC， 数据延迟                               | 补前端数据20亿条，为了加大速率调大了kudu一次刷出量为10W，导致10W对象迟迟无法释放，导致GC | 补数据看日志量进行处理。hive 或新开进程                      | 修复完毕                                     |
| 2020-04-24                                  | profile 归因日志多， 20249 就一个分区，数据消费慢 | 过滤归因日志后补上正常日志                                   | 调整了kudu 最大文件描述符，导致 N ameNode   Kudu 报 too many open files ，checkpoint无法写入，kudu无法写入，--------- 待观察解决 | 解决完毕                                     |
| 2020-06-24                                  | 巨大的20203广告写入量，导致                       | 读写冲突，kudu导hive失败， 写入延迟， 内存突增               | 20203 离线写入 ， 决定更换更好的磁盘                         | 解决完毕                                     |
| 2020-07-12                                  | impala重启，报表计算卡死                          | 原因未知，， impala重启，jdbc 连接没有失效？ 卡死？          | 重启，，                                                     |                                              |





|      | 问题                | 根源                                          | 解决办法                                            |
| ---- | ------------------- | --------------------------------------------- | --------------------------------------------------- |
| 1    | GA Event入库3天一挂 | 数据倾斜导致个别solt物理内存不足，            | 增加并行度，内存，更换数据通信模式,等新机器到位更换 |
| 2    | GA Profile 入库延迟 | 项目混布，solt 消费不均衡，需要增加sink并行度 | 今天更改代码，替换上线完毕                          |
| 3    | AXE 订单问题        | 项目多，执行慢，任务需要完全并行执行          | 更改代码，替换上线， 明天上线                       |
| 4    | AXE 异常重启问题    | 提交超时，触发reblance ,当前进程dead          | 更改配置，明天配合3上线                             |
| 5    | 日志缺失异常问题    | Flink 入库与导数据时间冲突                    | 1，待定不动  2，更换新方案  3 数仓V4版本上线        |
| 6    | 查询慢的问题        | V3方案的弊端， V4方案解决                     | 加快V4上线速度                                      |
|      |                     |                                               |                                                     |

